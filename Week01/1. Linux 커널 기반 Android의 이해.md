# Questions
## 1. Android가 Linux Kernel 위에서 동작하는 이유는 무엇인가?
Android가 Linux 기반으로 설계되었다는 것은 맞는 말이나, Linux System 의 전체 체계를 따르는 것은 아니다. 일반적으로 데스크탑에 탑재된 Linux System과는 다르다는 것이다. AOS는 오픈소스인 Linux Kernel 을 기반으로 설계되었으나, Linux Kernel의 일부 기능을 사용하면서 원하는 기능을 추가한 독자적인 운영체제이다.

### Android가 Linux Kernel 을 기반으로 설계된 이유가 무엇일까?
다음과 같은 Linux Kernel의 특징 덕분에 Android가 탄생할 수 있었다.

- 오픈 소스의 특성 활용
  - 오픈 소스이므로 수정, 확장, 배포가 자유롭기 때문에 필요에 따라 커널을 커스텀할 수 있다.
- 디바이스 호환성 높음
  - 다양한 디바이스와 하드웨어 플랫폼에서의 호환성이 뛰어나다.
  - 결국 이 기능도 오픈 소스이자 커스텀 가능한 Linux의 특징을 기반으로 한다.
  - ex. 디바이스 별로 개별적인 설계가 가능하여 성능이 좋지 않은 디바이스나 임베디드 기기 용으로 커널에 포함할 기능을 최소화할 수 있다.
- 기존 Linux Kernel 커널 기능 활용도 높음
  - Linux 커널의 메모리 관리, 프로세스 관리, 네트워크 스택 등 핵심 기능을 기반으로 새로운 OS 개발 시간을 단축하고 필요한 부분은 커스텀해서 사용할 수 있다.

 
Linux Kernel 의 전체적인 다이어그램은 다음과 같다.
![image](https://github.com/user-attachments/assets/dafcd285-39b4-44c4-ad4a-3ea00b317d22)


[+ AOSP (Andorid Open Source Platform) 의 계층 구조](https://source.android.com/docs/core/architecture?hl=ko)


---

## 2. Android 커널과 Linux 커널의 가장 큰 차이점은 무엇인가?
Android 커널은 Linux Kernel의 기본 기능을 활용하면서, Android 플랫폼에 특화된 몇 가지 기능들이 추가되어 있다.


두 요소의 조합이 Android를 강력하고 유연한 모바일 운영체제로 만든다.

### (1) Linux 커널의 기존 기능을 활용하는 부분
- 가상 메모리 관리: 페이지 교체 알고리즘(LRU)을 활용하여 메모리를 효율적으로 관리
- 프로세스 관리: 다중 프로세스 간의 스케줄링과 관리
- 네트워크 스택: TCP/IP 기반 네트워크 관리 기능
- 파일 시스템: Ext4 파일 시스템을 통해 데이터 저장 최적화
- Cgroups: 프로세스 그룹별 자원(CPU, 메모리, I/O) 제어 및 모니터링
- SELinux: Linux 기반의 보안 정책을 적용하여 접근 제어 강화

### (2) Android OS에 새롭게 커스텀되어 추가된 커널 기능
- Binder IPC: Android의 고유한 프로세스 간 통신 메커니즘으로, 효율적이고 안전한 데이터 전달 지원
- Wakelock: 전력 관리 기능으로, 특정 작업 중에 디바이스가 절전 모드로 전환되지 않도록 방지
- Low Memory Killer: 메모리 부족 상황에서 백그라운드 프로세스를 종료해 시스템 안정성 유지
- Ashmem (Anonymous Shared Memory): 프로세스 간 메모리 공유를 효율적으로 관리
- Doze 모드: 배터리 절약을 위해 장시간 사용하지 않을 때 저전력 모드로 전환
- Power HAL: 하드웨어 추상화 계층에서 저전력 모드 구현
- Logger: Android의 로그 관리 시스템으로 디버깅과 시스템 상태 모니터링에 활용
---

## 3. Android 커널에 추가된 주요 기능 설명
### Binder IPC
Android는 'Binder'라는 독특한 통신 메커니즘을 제공하는데, 이는 Linux 커널의 전통적인 IPC (Inter-Process Communication) 방식을 확장한 것이다.
Android 8.0 이상에서는 HAL(하드웨어 추상화 계층)이 Binder를 활용하여 IPC 방식으로 구현된다.
HIDL 및 AIDL은 HAL을 정의하는 인터페이스 언어로, HAL과 프레임워크 간 통신을 Binder 기반 IPC 호출을 통해 처리한다. (HIDL은 현재 지원되지 않고 AIDL로 대체되었다.)

- Binder의 개념은 A프로세스와 B프로세스 사이의 함수 및 데이터를 바인딩하는 것이다.
- 모든 프로세스가 공유할 수 있는 영역인 커널 공간에 요청 내용과 응답 내용을 쓰고, 프로세스가 그 메모리 주소를 참조하게 하는 것이다.
- 마치 RPC(Remote Produce) 처럼 작동하게 된다.
- 커널 공간을 사용하도록 바인더 드라이버가 구현되어 있다.
- 바인더 드라이버의 역할은 각 프로세스가 매핑해 놓은 메모리 주소와 커널 공간의 메모리 주소를 변환하여 참조해 사용할 수 있게 한다.
![image](https://github.com/user-attachments/assets/c496a980-e787-4ad9-a3bc-b7c34c35370e)

#### + 추가로 OS의 IPC와 RPC에 대해 보충 공부를 진행하면 좋을 것 같다!

## 4. Android 커널의 경량화와 저전력 특화 기능은 어떤 방식으로 구현되었는가?
### Wakelock
- WakeLock은 앱이 시스템을 활성화 상태로 유지할 수 있게 해준다.
- 앱이 중요한 작업을 하는 동안 디바이스가 절전 모드로 전환되지 않도록 보장하고, 작업이 끝난 후에는 다시 절전 모드로 전환한다.
- PowerManger 클래스의 메소드이며 앱이 항상 켜져있음을 나타내는 메커니즘으로, 해당 기능을 사용하기 위해서는 안드로이드 권한을 얻어야한다.
  ```xml
  <uses-permission android:name="android.permission.WAKE_LOCK" />
  ```
- 기기가 잠들어 있는 상태에서 화면을 깨우고 알람이 울려야 하는 상황 등에서 쓸 수 있다.
   - acquire() 함수를 통해 잠들어있는 단말기를 깨워서 알림을 울린 후, 바로 release() 함수를 통해 WakeLock을 해제해야 한다.
   - WakeLock을 사용하는 순간, 많은 배터리를 지속 소모하기 때문에 WakeLock이 더 이상 필요없는 시점에 최대한 빨리 release() 작업을 수행해야 한다.
   -> 그렇기 때문에 단말기를 깨운 직후 바로 WakeLock을 해제하는 것이 좋다.


### Doze mode
- 'Doze'라는 저전력 모드를 통해 배터리 소모를 줄인다.
- Doze mode는 디바이스가 일정 시간 동안 사용되지 않을 때 시스템을 절전 모드로 전환, 네트워크 연결이나 센서 등의 활동을 최소화한다.

### Power HAL
- HAL(Hardware Abstraction Layer)은 저전력 기능을 하드웨어에 맞게 최적화하여 하드웨어와의 직접적인 연동을 하는 계층이다.

---
ref.
- [Andorid와 Linux Kernel](https://www.howtogeek.com/189036/android-is-based-on-linux-but-what-does-that-mean/)
- [공식 문서: Android Kernel 개요](https://source.android.com/docs/core/architecture/kernel?hl=ko)
- [공식 문서: 하드웨어 추상화 계층 HAL](https://source.android.com/docs/core/architecture/hal?hl=ko)
- [Deep Dive into Android - IPC/Binder Framework](https://www.protechtraining.com/static/slides/Deep_Dive_Into_Binder_Presentation.html)
- [Android Binder IPC - naver d2](https://d2.naver.com/helloworld/47656)
- [Android Binder](https://bluemoon-1st.tistory.com/55)
- [Andorid WakeLock](https://bumjae.tistory.com/28)
- [WakeLock으로 잠든 폰 깨우기](https://yeolco.tistory.com/92)
